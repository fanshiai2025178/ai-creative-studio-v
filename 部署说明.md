# AI Creative Studio - 自动部署说明

## 已完成的准备工作
✅ 代码已打包: `f:\ai-creative-studio-deploy.zip`

## 方式一：使用 WinSCP（推荐）

### 1. 下载并安装 WinSCP
如果没有安装，从 https://winscp.net/ 下载

### 2. 使用脚本上传文件
```powershell
"C:\Program Files (x86)\WinSCP\WinSCP.com" /script=f:\ai-creative-studio-v\winscp-upload.txt
```

### 3. SSH 连接到服务器
```powershell
ssh root@72.61.74.232
# 密码: sjbw8888@1989827Y
```

### 4. 执行部署命令
连接后复制粘贴以下所有命令：

```bash
# 停止现有应用
pm2 stop all
pm2 delete all

# 清理并解压新代码
cd /var/www/ai-creative-studio
rm -rf *
unzip /tmp/ai-creative-studio-deploy.zip -d .

# 创建 .env 配置文件
cat > .env << 'EOF'
DATABASE_URL=mysql://ai_user:FanShai2026DB@Pass@72.61.74.232:3306/ai_creative_studio
JWT_SECRET=your-super-secret-jwt-key-2026
PORT=3000
NODE_ENV=production
EOF

# 安装依赖并构建
pnpm install
pnpm run build

# 数据库迁移
pnpm run db:push

# 启动应用
pm2 start dist/index.js --name ai-creative-studio
pm2 save

# 查看状态
pm2 status
pm2 logs ai-creative-studio --lines 50
```

## 方式二：使用 PowerShell SSH（如果已安装 OpenSSH）

### 1. 上传文件
```powershell
scp f:\ai-creative-studio-deploy.zip root@72.61.74.232:/tmp/
# 输入密码: sjbw8888@1989827Y
```

### 2. 连接并部署
```powershell
ssh root@72.61.74.232
# 输入密码: sjbw8888@1989827Y
```

然后执行上面"方式一"中的第4步命令。

## 验证部署

部署完成后访问：
- **网站**: http://fansai.online
- **API**: http://fansai.online/api/trpc

## 常见问题

### 如果构建失败
```bash
# 查看详细日志
pm2 logs ai-creative-studio

# 检查 Node.js 和 pnpm 版本
node -v  # 应该是 v18+
pnpm -v
```

### 如果数据库连接失败
```bash
# 测试数据库连接
mysql -h 72.61.74.232 -u ai_user -p'FanShai2026DB@Pass' ai_creative_studio
```

### 查看 Nginx 日志
```bash
tail -f /var/log/nginx/error.log
tail -f /var/log/nginx/access.log
```
